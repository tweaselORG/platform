---
import { t } from '../../../../i18n/server';
import Base from '../../../../layouts/base.astro';
import { absUrl } from '../../../../lib/util';
import { e, client } from '../../../../lib/db';

const { token } = Astro.params;

if (!token) throw new Error('This should never happen.');

const proceeding = await e
    .select(e.Proceeding, () => ({
        state: true,

        filter_single: { token },
    }))
    .assert_single()
    .run(client);

if (proceeding?.state !== 'awaitingControllerResponse')
    return new Response('YoYou cannot evaluate the response to this proceeding now.', { status: 400 });
---

<Base title={t('evaluate-response', 'heading')}>
    <p>{t('evaluate-response', 'explanation')}</p>

    <div class="col66 col100-mobile">
        <div class="radio-group radio-group-vertical radio-group-padded">
            {
                (['promise', 'denial', 'none'] as const).map((r) => (
                    <form class="radio-wrapper" method="POST" action={absUrl(`/p/${token}/evaluate-response/${r}`)}>
                        <button type="submit" class="radio-label">
                            {t('evaluate-response', `reponse-${r}`)}
                        </button>
                    </form>
                ))
            }
        </div>
    </div>
</Base>
